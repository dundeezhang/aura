{% extends 'base.html' %}

<!--Head-->

{% block head %}
<link
    rel="stylesheet"
    href="{{ url_for('static', filename='css/signature.css') }}"
/>
{% endblock %}

<!--Body-->

{% block body %}
<h1>Signature Generator</h1>

<div class="main-content">
    <div class="">
        <h3>Enter Name to Update Image</h3>
        <form id="updateForm">
            <input
                type="text"
                id="nameInput"
                name="name"
                placeholder="Enter name"
                required
            />
            <button type="submit">Generate Signature</button>
        </form>
        <img id="displayImage" src="{{ image_url }}" alt="Image" width="300" />
        <p id="loadingMessage" style="display: none">Loading...</p>

        <p id="errorMessage" style="color: red"></p>
    </div>
</div>

<script>
    document
        .getElementById("updateForm")
        .addEventListener("submit", function (event) {
            event.preventDefault();

            let name = document.getElementById("nameInput").value;
            let loadingMessage = document.getElementById("loadingMessage");
            let displayImage = document.getElementById("displayImage");
            let errorMessage = document.getElementById("errorMessage");

            // Show loading message
            loadingMessage.style.display = "block";
            errorMessage.textContent = "";

            fetch("/update-image", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: "name=" + encodeURIComponent(name),
            })
                .then((response) => response.json())
                .then((data) => {
                    loadingMessage.style.display = "none";
                    if (data.success) {
                        displayImage.src = data.new_url;
                        errorMessage.textContent = "";
                    } else {
                        errorMessage.textContent =
                            "Name not found. Try another.";
                    }
                })
                .catch(() => {
                    loadingMessage.style.display = "none";
                    errorMessage.textContent =
                        "An error occurred. Please try again.";
                });
        });

    document
        .getElementById("nameInput")
        .addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();

                let name = document.getElementById("nameInput").value;
                let loadingMessage = document.getElementById("loadingMessage");
                let displayImage = document.getElementById("displayImage");
                let errorMessage = document.getElementById("errorMessage");

                // Show loading message
                loadingMessage.style.display = "block";
                errorMessage.textContent = "";

                fetch("/update-image", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: "name=" + encodeURIComponent(name),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        loadingMessage.style.display = "none";
                        if (data.success) {
                            displayImage.src = data.new_url;
                            errorMessage.textContent = "";
                        } else {
                            errorMessage.textContent =
                                "Name not found. Try another.";
                        }
                    })
                    .catch(() => {
                        loadingMessage.style.display = "none";
                        errorMessage.textContent =
                            "An error occurred. Please try again.";
                    });
            }
        });
</script>

{% endblock %}
